###
# This file was automatically generated with nix-actions.
jobs:
  akhaten:
    name: Build akhaten
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build akhaten
      run: nix-build -A checks.machines.akhaten --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/akhaten\\\",\\\"description\\\":\\\"akhaten\\\
        \"}\"\n"
  arcadia:
    name: Build arcadia
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build arcadia
      run: nix-build -A checks.machines.arcadia --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/arcadia\\\",\\\"description\\\":\\\"arcadia\\\
        \"}\"\n"
  biblios:
    name: Build biblios
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build biblios
      run: nix-build -A checks.machines.biblios --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/biblios\\\",\\\"description\\\":\\\"biblios\\\
        \"}\"\n"
  core-data:
    name: Build core-data
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build core-data
      run: nix-build -A checks.machines.core-data --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/core-data\\\",\\\"description\\\":\\\"core-data\\\
        \"}\"\n"
  core-security:
    name: Build core-security
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build core-security
      run: nix-build -A checks.machines.core-security --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/core-security\\\",\\\"description\\\":\\\"\
        core-security\\\"}\"\n"
  darillium:
    name: Build darillium
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build darillium
      run: nix-build -A checks.machines.darillium --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/darillium\\\",\\\"description\\\":\\\"darillium\\\
        \"}\"\n"
  epyc-container:
    name: Build epyc-container
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build epyc-container
      run: nix-build -A checks.machines.epyc-container --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/epyc-container\\\",\\\"description\\\":\\\"\
        epyc-container\\\"}\"\n"
  fischer:
    name: Build fischer
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build fischer
      run: nix-build -A checks.machines.fischer --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/fischer\\\",\\\"description\\\":\\\"fischer\\\
        \"}\"\n"
  gallifrey:
    name: Build gallifrey
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build gallifrey
      run: nix-build -A checks.machines.gallifrey --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/gallifrey\\\",\\\"description\\\":\\\"gallifrey\\\
        \"}\"\n"
  gustave:
    name: Build gustave
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build gustave
      run: nix-build -A checks.machines.gustave --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/gustave\\\",\\\"description\\\":\\\"gustave\\\
        \"}\"\n"
  jacques:
    name: Build jacques
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build jacques
      run: nix-build -A checks.machines.jacques --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/jacques\\\",\\\"description\\\":\\\"jacques\\\
        \"}\"\n"
  lambda:
    name: Eval lambda (aarch64)
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Evaluate lambda
      run: nix-instantiate -A checks.machines.lambda
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/lambda\\\",\\\"description\\\":\\\"lambda\\\
        \"}\"\n"
  tower:
    name: Build tower
    runs-on: epyc
    steps:
    - uses: actions/checkout@v6
      with:
        fetch-depth: 0
    - env:
        DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
      name: Fetch private submodules
      run: "mkdir -p ~/.ssh\necho \"$DEPLOY_KEY\" > ~/.ssh/deploy_key\nchmod 600 ~/.ssh/deploy_key\n\
        ssh-keyscan git.luj.fr >> ~/.ssh/known_hosts 2>/dev/null\nGIT_SSH_COMMAND=\"\
        ssh -i ~/.ssh/deploy_key\" git submodule update --init --recursive\n"
    - name: Build tower
      run: nix-build -A checks.machines.tower --no-out-link
    - env:
        COMMIT_SHA: ${{ github.sha }}
        FORGEJO_TOKEN: ${{ github.token }}
        GH_TOKEN: ${{ secrets.GH_STATUS_TOKEN }}
        JOB_NAME: ${{ github.job }}
        JOB_STATUS: ${{ job.status }}
        RUN_NUMBER: ${{ github.run_number }}
      if: always()
      name: Report status to GitHub
      run: "STATE=\"$JOB_STATUS\"\nif [ \"$STATE\" = \"cancelled\" ]; then STATE=error;
        fi\n\nFORGEJO_URL=\"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY\"\nTARGET_URL=\"\
        $FORGEJO_URL/actions/runs/$RUN_NUMBER\"\n\n# Try to resolve the exact job
        URL via Forgejo API\nJOBS=$(curl -sS -H \"Authorization: token $FORGEJO_TOKEN\"\
        \ \\\n  \"$GITHUB_SERVER_URL/api/v1/repos/$GITHUB_REPOSITORY/actions/runs/$RUN_NUMBER/jobs\"\
        \ 2>/dev/null) || true\nif [ -n \"$JOBS\" ]; then\n  JOB_URL=$(echo \"$JOBS\"\
        \ | jq -r --arg name \"$JOB_NAME\" \\\n    '.jobs[] | select(.name == $name)
        | .html_url' 2>/dev/null | head -1) || true\n  [ -n \"$JOB_URL\" ] && TARGET_URL=\"\
        $JOB_URL\"\nfi\n\ncurl -sS -X POST \\\n  -H \"Authorization: token $GH_TOKEN\"\
        \ \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/julienmalka/snowfield/statuses/$COMMIT_SHA\"\
        \ \\\n  -d \"{\\\"state\\\":\\\"$STATE\\\",\\\"target_url\\\":\\\"$TARGET_URL\\\
        \",\\\"context\\\":\\\"forgejo/tower\\\",\\\"description\\\":\\\"tower\\\"\
        }\"\n"
name: Evaluate and build machines
on:
  pull_request:
    branches:
    - main
  push:
    branches:
    - main
